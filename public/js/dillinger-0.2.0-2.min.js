
$(function(){function x(e,t){(function(n,r){var i=n.createElement(r),s=n.getElementsByTagName(r)[0];i.async=1,i.src=e,s.parentNode.insertBefore(i,s),i.onload=function(){t&&t()}})(document,"script")}function T(){var e;try{localStorage.getItem&&(e=localStorage)}catch(t){}return e}function N(){var e;try{e=JSON.parse(localStorage.profile),e=$.extend(!0,u,e)}catch(t){e=u}u=e}function C(e){localStorage.clear(),localStorage.profile=JSON.stringify($.extend(!0,u,e))}function k(e){return A(e,"pfx")}function L(e,t){for(var n in e)if(h[e[n]]!==undefined)return t==="pfx"?e[n]:!0;return!1}function A(e,t){var n=e.charAt(0).toUpperCase()+e.substr(1),r=(e+" "+p.join(n+" ")+n).split(" ");return L(r,t)}function O(){var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"msTransitionEnd",transition:"transitionEnd"};return e[k("transition")]}function M(e){return"dillinger_"+(new Date).toISOString().replace(/[\.:-]/g,"_")+"."+e}function _(){return $('#filename > span[contenteditable="true"]').text()}function D(e){$('#filename > span[contenteditable="true"]').text(e||u.current_filename||"Untitled Document")}function P(){T()?($.support.transitionEnd=O(),N(),H(),B(),t=new Showdown.converter,tt(),nt(),rt(),it(),et(),I()):K()}function H(){e=ace.edit("editor")}function B(){U(u.theme,function(){m.find('li > a[data-value="'+u.theme+'"]').addClass("selected"),e.getSession().setUseWrapMode(!0),e.setShowPrintMargin(!1),e.getSession().setMode("ace/mode/markdown"),e.getSession().setValue(u.currentMd||e.getSession().getValue()),W()}),g.css("backgroundImage",u.showPaper?'url("'+o+'")':'url("")'),y.html(u.autosave.enabled?'<i class="icon-remove"></i>&nbsp;Disable Autosave':'<i class="icon-ok"></i>&nbsp;Enable Autosave'),i=w.attr("data-github-username"),i&&st.showMessage("What's Up "+i,1e3),r=d.css("right"),D(),$(".dropdown-toggle").dropdown()}function j(){e.getSession().setValue(""),W()}function F(t){C({currentMd:e.getSession().getValue()}),t&&st.showMessage(st.messages.docSavedLocal)}function I(){u.autosave.enabled?n=setInterval(function(){F()},u.autosave.interval):clearInterval(n)}function q(){localStorage.clear(),u.autosave.enabled=!1,delete localStorage.profile,window.location.reload()}function R(e){var t=$(e.target);if(t.attr("data-value")===u.theme)return;m.find("li > a.selected").removeClass("selected"),t.addClass("selected");var n=t.attr("data-value");$(e.target).blur(),U(n,function(){st.showMessage(st.messages.profileUpdated)})}function U(t,n){var r=t.split("/").pop();x("/js/theme-"+r+".js",function(){e.setTheme(t),n&&n(),z(r),C({theme:t})})}function z(e){document.body.style.backgroundColor=S[e]}function W(){var n=e.getSession().getValue(),r=t.makeHtml(n);g.html("").html(r)}function X(e){typeof e=="string"?f=e:f=_(),C({current_filename:f})}function V(){function n(e,t){}function r(e,t,n){var r=JSON.parse(n.responseText);document.getElementById("downloader").src="/files/md/"+r.data}function i(e,t,n){alert("Roh-roh. Something went wrong. :(")}function s(e,t){}var t=e.getSession().getValue(),o={type:"POST",data:"unmd="+encodeURIComponent(t),dataType:"json",url:"/factory/fetch_markdown",beforeSend:n,error:i,success:r,complete:s};$.ajax(o)}function J(){function n(e,t){}function r(e,t,n){var r=JSON.parse(n.responseText);document.getElementById("downloader").src="/files/html/"+r.data}function i(e,t,n){alert("Roh-roh. Something went wrong. :(")}function s(e,t){}var t=e.getSession().getValue(),o={type:"POST",data:"unmd="+encodeURIComponent(t),dataType:"json",url:"/factory/fetch_html",beforeSend:n,error:i,success:r,complete:s};$.ajax(o)}function K(){alert("Sad Panda - No localStorage for you!")}function Q(){$(".modal-header h3").text("What's the deal with Dillinger?");var e="<p>Dillinger is an online cloud-enabled, HTML5, buzzword-filled Markdown editor.</p><p>Dillinger was designed and developed by <a href='http://twitter.com/joemccann'>@joemccann</a> because he needed a decent Markdown editor.</p><p>Dillinger is a 100% open source project so <a href='https://github.com/joemccann/dillinger'>fork the code</a> and contribute!</p><p>Follow Dillinger on Twitter at <a href='http://twitter.com/dillingerapp'>@dillingerapp</a></p>";$(".modal-body").html(e),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0})}function G(){$(".modal-header h3").text("Preferences");var e='<div><ul><li><a href="#" id="paper">Toggle Paper</a></li><li><a href="#" id="reset">Reset Profile</a></li></ul></div>';$(".modal-body").html(e),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0})}function Y(){g.css("backgroundImage",u.showPaper?'url("")':'url("'+o+'")'),C({showPaper:!u.showPaper}),st.showMessage(st.messages.profileUpdated)}function Z(){y.html(u.autosave.enabled?'<i class="icon-remove"></i>&nbsp;Disable Autosave':'<i class="icon-ok"></i>&nbsp;Enable Autosave'),C({autosave:{enabled:!u.autosave.enabled}}),I()}function et(){$('#filename > span[contenteditable="true"]').bind("keyup",X)}function tt(){$("#editor").bind("keyup",W)}function nt(){m.find("li > a").bind("click",function(e){return R(e),!1}),$("#clear").on("click",function(){return j(),!1}),$("#save_dropbox").on("click",function(){return u.current_filename=u.current_filename||"/Dillinger/"+M("md"),ut.putMarkdownFile(),F(),!1}),$(".modal-body").delegate("#paper","click",function(){return Y(),!1}),$("#autosave").on("click",function(){return Z(),!1}),$("#reset").on("click",function(){return q(),!1}),w.on("click",function(){return ot.fetchRepos(),!1}),$("#import_dropbox").on("click",function(){return ut.searchDropbox(),!1}),$("#export_md").on("click",function(){return V(),$(".dropdown").removeClass("open"),!1}),$("#export_html").on("click",function(){return J(),$(".dropdown").removeClass("open"),!1}),$("#preferences").on("click",function(){return G(),!1}),$("#about").on("click",function(){return Q(),!1})}function rt(){key("command+s, ctrl+s",function(e){F(!0),e.preventDefault()});var e={name:"save",bindKey:{mac:"Command-S",win:"Ctrl-S"},exec:function(){F()}}}function it(){$(document).on("click",".repo",function(){var e=$(this).parent("li").attr("data-repo-name");return ot.isRepoPrivate=$(this).parent("li").attr("data-repo-private")==="true"?!0:!1,ot.fetchBranches(e),!1}).on("click",".branch",function(){var e=$(this).parent("li").attr("data-repo-name"),t=$(this).parent("li").attr("data-commit-sha");return ot.currentBranch=$(this).text(),ot.fetchTreeFiles(e,t),!1}).on("click",".tree_file",function(){var e=$(this).parent("li").attr("data-tree-file");return ot.fetchMarkdownFile(e),!1}).on("click",".dropbox_file",function(){var e=$(this).parent("li").attr("data-file-path");return u.current_filename=e.split("/").pop().replace(".md",""),ut.setFilePath(e),ut.fetchMarkdownFile(e),!1})}var e,t,n,r,i,s=!0,o="/img/notebook_paper_200x200.gif",u={theme:"ace/theme/clouds_midnight",showPaper:!0,currentMd:"",autosave:{enabled:!0,interval:3e3},current_filename:"Untitled Document",dropbox:{filepath:"/Dillinger/"}},l="dillinger",c=document.createElement(l),h=c.style,p="Webkit Moz O ms Khtml".split(" "),d=$(".cont"),v=$(".core_menu"),m=$("#theme-list"),g=$("#preview"),y=$("#autosave"),w=$("#import_github"),E=$("nav"),S={chrome:"#bbbbbb",clouds:"#7AC9E3",clouds_midnight:"#5F9EA0",cobalt:"#4d586b",crimson_editor:"#ffffff",dawn:"#DADCAD",eclipse:"#6C7B8A",idle_fingers:"#DEB887",kr_theme:"#434343",merbivore:"#3E353E",merbivore_soft:"#565156",mono_industrial:"#C0C0C0",monokai:"#F5DEB3",pastel_on_dark:"#676565","solarized-dark":"#0E4B5A",solarized_light:"#dfcb96",textmate:"#fff",tomorrow:"#0e9211",tomorrow_night:"#333536",tomorrow_night_blue:"#3a4150",tomorrow_night_bright:"#3A3A3A",tomorrow_night_eighties:"#474646",twilight:"#534746",vibrant_ink:"#363636"},st=function(){var e=$("#notify");return{messages:{profileUpdated:"Profile updated",profileCleared:"Profile cleared",docSavedLocal:"Document saved locally",docSavedServer:"Document saved on our server",docSavedDropbox:"Document saved on dropbox",dropboxImportNeeded:"Please import a file from dropbox first."},showMessage:function(t,n){e.text("").stop().text(t).slideDown(250,function(){e.delay(n||1e3).slideUp(250)})}}}(),ot=function(){function t(e,t){return a=e.url.toLowerCase(),b=t.url.toLowerCase(),a===b?0:isNaN(e)||isNaN(t)?a>b?1:-1:e-t}function n(e){return/(\.md)|(\.markdown)/i.test(e)}function r(e,t){var r=[],s="https://raw.github.com",o="/";return t.forEach(function(t){if(n(t.path)){var u;ot.isRepoPrivate?u=t.url:u=s+o+i+o+e+o+ot.currentBranch+o+t.path;var a={link:u,path:t.path,sha:t.sha};r.push(a)}}),r}function s(e){var n="<ul>";return e.sort(t),e.forEach(function(e){var t=e.url.split("/").pop();n+='<li data-repo-name="'+t+'" data-repo-private="'+e.private+'"><a class="repo" href="#">'+t+"</a></li>"}),n+="</ul>",$(".modal-header h3").text("Your Github Repos"),$(".modal-body").html(n),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0}),!1}function o(e,t){var n="";t.forEach(function(t){var r=t.name,i=t.commit.sha;n+='<li data-repo-name="'+e+'" data-commit-sha="'+i+'"><a class="branch" href="#">'+r+"</a></li>"}),$(".modal-header h3").text(e),$(".modal-body").find("ul").find("li").remove().end().append(n)}function u(e,t){var n=r(e,t),i="";n.forEach(function(e){i+=ot.isRepoPrivate?'<li data-tree-file-sha="'+e.sha+'" data-tree-file="'+e.link+'" class="private_repo"><a class="tree_file" href="#">'+e.path+"</a></li>":'<li data-tree-file="'+e.link+'"><a class="tree_file" href="#">'+e.path+"</a></li>"}),$(".modal-header h3").text(e),$(".modal-body").find("ul").find("li").remove().end().append(i)}return{currentBranch:"",isRepoPrivate:!1,fetchRepos:function(){function e(e,t){st.showMessage("Fetching Repos...")}function t(e,t,n){n=JSON.parse(n.responseText),n.length?s(n):st.showMessage("No repos available!")}function n(e,t,n){alert("Roh-roh. Something went wrong. :(")}function r(e,t){}var i={type:"POST",dataType:"text",url:"/import/github/repos",beforeSend:e,error:n,success:t,complete:r};$.ajax(i)},fetchBranches:function(e){function t(t,n){st.showMessage("Fetching Branches for Repo "+e)}function n(t,n,r){r=JSON.parse(r.responseText),r.length?o(e,r):(st.showMessage("No branches available!"),$("#modal-generic").modal("hide"))}function r(e,t,n){alert("Roh-roh. Something went wrong. :(")}function i(e,t){}var s={type:"POST",dataType:"json",data:"repo="+e,url:"/import/github/branches",beforeSend:t,error:r,success:n,complete:i};$.ajax(s)},fetchTreeFiles:function(e,t){function n(t,n){st.showMessage("Fetching Tree for Repo "+e)}function r(t,n,r){r=JSON.parse(r.responseText),r.tree.length?u(e,r.tree):(st.showMessage("No tree files available!"),$("#modal-generic").modal("hide"))}function i(e,t,n){alert("Roh-roh. Something went wrong. :(")}function s(e,t){}var o={type:"POST",dataType:"json",data:"repo="+e+"&sha="+t,url:"/import/github/tree_files",beforeSend:n,error:i,success:r,complete:s};$.ajax(o)},fetchMarkdownFile:function(t){function n(e,t){}function r(n,r,i){i=JSON.parse(i.responseText);if(i.error)st.showMessage("No markdown for you!"),$("#modal-generic").modal("hide");else{$("#modal-generic").modal("hide"),e.getSession().setValue(i.data);var s=t.split("/").pop();X(s),D(s),W()}}function i(e,t,n){alert("Roh-roh. Something went wrong. :(")}function s(e,t){$(".dropdown").removeClass("open")}var o={type:"POST",dataType:"json",data:"mdFile="+t,url:"/import/github/file",beforeSend:n,error:i,success:r,complete:s};$.ajax(o)}}}(),ut=function(){function t(e,t){return a=e.path.toLowerCase(),b=t.path.toLowerCase(),a===b?0:isNaN(e)||isNaN(t)?a>b?1:-1:e-t}function n(e){var n="<ul>";return e.sort(t),e.forEach(function(e){n+='<li data-file-path="'+e.path+'"><a class="dropbox_file" href="#">'+e.path+"</a></li>"}),n+="</ul>",$(".modal-header h3").text("Your Dropbox Files"),$(".modal-body").html(n),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0}),!1}function r(e){return encodeURIComponent(e.split("/").pop())}function i(e){var t=e.split("/").pop();return e.replace(t,"")}return{fetchAccountInfo:function(){function e(e,t){st.showMessage("Fetching User Info from Dropbox")}function t(e,t,n){var r=JSON.parse(n.responseText);st.showMessage("Sup "+r.display_name)}function n(e,t,n){alert("Roh-roh. Something went wrong. :(")}function r(e,t){}var i={type:"GET",dataType:"json",url:"/account/dropbox",beforeSend:e,error:n,success:t,complete:r};$.ajax(i)},fetchMetadata:function(){function e(e,t){st.showMessage("Fetching Metadata")}function t(e,t,n){var r=JSON.parse(n.responseText)}function n(e,t,n){alert("Roh-roh. Something went wrong. :(")}function r(e,t){}var i={type:"GET",dataType:"json",url:"/dropbox/metadata",beforeSend:e,error:n,success:t,complete:r};$.ajax(i)},searchDropbox:function(){function e(e,t){st.showMessage("Searching for .md Files")}function t(e,t,r){var i=JSON.parse(r.responseText);if(i.hasOwnProperty("statusCode")&&i.statusCode===401){var t=JSON.parse(i.data);st.showMessage("Error! "+t.error,1e3),setTimeout(function(){st.showMessage("Reloading!"),window.location.reload()},1250);return}i.length?n(i):st.showMessage("No .md files found!")}function r(e,t,n){alert("Roh-roh. Something went wrong. :(")}function i(e,t){}var s={type:"GET",dataType:"json",url:"/import/dropbox",beforeSend:e,error:r,success:t,complete:i};$.ajax(s)},fetchMarkdownFile:function(t){function n(e,t){}function s(t,n,r){r=JSON.parse(r.responseText);if(r.statusCode===404){var i=JSON.parse(r.data);st.showMessage(i.error)}else $("#modal-generic").modal("hide"),X(u.current_filename),D(),e.getSession().setValue(r.data),W()}function o(e,t,n){alert("Roh-roh. Something went wrong. :(")}function a(e,t){}var f=r(t),l=i(t);t=l+f;var c={type:"POST",dataType:"json",data:"mdFile="+t,url:"/fetch/dropbox",beforeSend:n,error:o,success:s,complete:a};$.ajax(c)},setFilePath:function(e){e=i(e),C({dropbox:{filepath:e}})},putMarkdownFile:function(){function t(e,t){}function n(e,t,n){n=JSON.parse(n.responseText);if(n.statusCode>=204){var r=JSON.parse(n.data);st.showMessage(r.error,5e3)}else $("#modal-generic").modal("hide"),st.showMessage(st.messages.docSavedDropbox)}function r(e,t,n){alert("Roh-roh. Something went wrong. :(")}function i(e,t){}var s=encodeURIComponent(e.getSession().getValue()),o="pathToMdFile="+u.dropbox.filepath+encodeURIComponent(u.current_filename)+".md"+"&fileContents="+s,a={type:"POST",dataType:"json",data:o,url:"/save/dropbox",beforeSend:t,error:r,success:n,complete:i};$.ajax(a)}}}();P()}),window.onload=function(){var e=$("#loading");e.bind($.support.transitionEnd,function(t){$("#main").removeClass("bye"),e.remove()}).addClass("fade_slow")}