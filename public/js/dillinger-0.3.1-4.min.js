
$(function(){function p(a,b){(function(c,d){var e=c.createElement(d),f=c.getElementsByTagName(d)[0];e.async=1,e.src=a,f.parentNode.insertBefore(e,f),e.onload=function(){b&&b()}})(document,"script")}function q(){var a;try{localStorage.getItem&&(a=localStorage)}catch(b){}return a}function r(){var a;try{a=JSON.parse(localStorage.profile),a=$.extend(!0,f,a)}catch(b){a=f}f=a}function s(a){localStorage.clear(),localStorage.profile=JSON.stringify($.extend(!0,f,a))}function t(a){return v(a,"pfx")}function u(a,b){for(var c in a)if(i[a[c]]!==undefined)return b==="pfx"?a[c]:!0;return!1}function v(a,b){var c=a.charAt(0).toUpperCase()+a.substr(1),d=(a+" "+j.join(c+" ")+c).split(" ");return u(d,b)}function w(){var a={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"msTransitionEnd",transition:"transitionend"};return a[t("transition")]}function x(a){return"dillinger_"+(new Date).toISOString().replace(/[\.:-]/g,"_")+"."+a}function y(){return $('#filename > span[contenteditable="true"]').text()}function z(a){$('#filename > span[contenteditable="true"]').text(a||f.current_filename||"Untitled Document")}function A(){q()?($.support.transitionEnd=w(),r(),B(),C(),b=new Showdown.converter,U(),V(),W(),X(),T(),F()):O()}function B(){a=ace.edit("editor")}function C(){I(f.theme,function(){k.find('li > a[data-value="'+f.theme+'"]').addClass("selected"),a.getSession().setUseWrapMode(!0),a.setShowPrintMargin(!1),a.getSession().setMode("ace/mode/markdown"),a.getSession().setValue(f.currentMd||a.getSession().getValue()),K()}),l.css("backgroundImage",f.showPaper?'url("'+e+'")':'url("")'),m.html(f.autosave.enabled?'<i class="icon-remove"></i>&nbsp;Disable Autosave':'<i class="icon-ok"></i>&nbsp;Enable Autosave'),d=n.attr("data-github-username"),d&&Y.showMessage("What's Up "+d,1e3),z(),$(".dropdown-toggle").dropdown()}function D(){a.getSession().setValue(""),K()}function E(b){s({currentMd:a.getSession().getValue()}),b&&Y.showMessage(Y.messages.docSavedLocal)}function F(){f.autosave.enabled?c=setInterval(function(){E()},f.autosave.interval):clearInterval(c)}function G(){localStorage.clear(),f.autosave.enabled=!1,delete localStorage.profile,window.location.reload()}function H(a){var b=$(a.target);if(b.attr("data-value")===f.theme)return;k.find("li > a.selected").removeClass("selected"),b.addClass("selected");var c=b.attr("data-value");$(a.target).blur(),I(c,function(){Y.showMessage(Y.messages.profileUpdated)})}function I(b,c){var d=b.split("/").pop();p("/js/theme-"+d+".js",function(){a.setTheme(b),c&&c(),J(d),s({theme:b})})}function J(a){document.body.style.backgroundColor=o[a]}function K(){var c=a.getSession().getValue(),d=b.makeHtml(c);l.html("").html(d)}function L(a){var b;typeof a=="string"?b=a:b=y(),s({current_filename:b})}function M(){function c(a,b,c){a=b=null;var d=JSON.parse(c.responseText);document.getElementById("downloader").src="/files/md/"+d.data}function d(){alert("Roh-roh. Something went wrong. :(")}var b=a.getSession().getValue(),e={type:"POST",data:"unmd="+encodeURIComponent(b),dataType:"json",url:"/factory/fetch_markdown",error:d,success:c};$.ajax(e)}function N(){function c(a,b,c){var d=JSON.parse(c.responseText);document.getElementById("downloader").src="/files/html/"+d.data}function d(){alert("Roh-roh. Something went wrong. :(")}var b=a.getSession().getValue(),e={type:"POST",data:"unmd="+encodeURIComponent(b),dataType:"json",url:"/factory/fetch_html",error:d,success:c};$.ajax(e)}function O(){alert("Sad Panda - No localStorage for you!")}function P(){$(".modal-header h3").text("What's the deal with Dillinger?");var a="<p>Dillinger is an online cloud-enabled, HTML5, buzzword-filled Markdown editor.</p><p>Dillinger was designed and developed by <a href='http://twitter.com/joemccann'>@joemccann</a> because he needed a decent Markdown editor.</p><p>Dillinger is a 100% open source project so <a href='https://github.com/joemccann/dillinger'>fork the code</a> and contribute!</p><p>Follow Dillinger on Twitter at <a href='http://twitter.com/dillingerapp'>@dillingerapp</a></p>";$(".modal-body").html(a),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0})}function Q(){$(".modal-header h3").text("Preferences");var a='<div><ul><li><a href="#" id="paper">Toggle Paper</a></li><li><a href="#" id="reset">Reset Profile</a></li></ul></div>';$(".modal-body").html(a),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0})}function R(){l.css("backgroundImage",f.showPaper?'url("")':'url("'+e+'")'),s({showPaper:!f.showPaper}),Y.showMessage(Y.messages.profileUpdated)}function S(){m.html(f.autosave.enabled?'<i class="icon-remove"></i>&nbsp;Disable Autosave':'<i class="icon-ok"></i>&nbsp;Enable Autosave'),s({autosave:{enabled:!f.autosave.enabled}}),F()}function T(){$('#filename > span[contenteditable="true"]').bind("keyup",L)}function U(){$("#editor").bind("keyup",K)}function V(){k.find("li > a").bind("click",function(a){return H(a),!1}),$("#clear").on("click",function(){return D(),!1}),$("#save_dropbox").on("click",function(){return f.current_filename=f.current_filename||"/Dillinger/"+x("md"),_.putMarkdownFile(),E(),!1}),$(".modal-body").delegate("#paper","click",function(){return R(),!1}),$("#autosave").on("click",function(){return S(),!1}),$("#reset").on("click",function(){return G(),!1}),n.on("click",function(){return Z.fetchRepos(),!1}),$("#import_dropbox").on("click",function(){return _.searchDropbox(),!1}),$("#export_md").on("click",function(){return M(),$(".dropdown").removeClass("open"),!1}),$("#export_html").on("click",function(){return N(),$(".dropdown").removeClass("open"),!1}),$("#preferences").on("click",function(){return Q(),!1}),$("#about").on("click",function(){return P(),!1})}function W(){key("command+s, ctrl+s",function(a){E(!0),a.preventDefault()});var a={name:"save",bindKey:{mac:"Command-S",win:"Ctrl-S"},exec:function(){E()}}}function X(){$(document).on("click",".repo",function(){var a=$(this).parent("li").attr("data-repo-name");return Z.isRepoPrivate=$(this).parent("li").attr("data-repo-private")==="true"?!0:!1,Z.fetchBranches(a),!1}).on("click",".branch",function(){var a=$(this).parent("li").attr("data-repo-name"),b=$(this).parent("li").attr("data-commit-sha");return Z.currentBranch=$(this).text(),Z.fetchTreeFiles(a,b),!1}).on("click",".tree_file",function(){var a=$(this).parent("li").attr("data-tree-file");return Z.fetchMarkdownFile(a),!1}).on("click",".dropbox_file",function(){var a=$(this).parent("li").attr("data-file-path");return f.current_filename=a.split("/").pop().replace(".md",""),_.setFilePath(a),_.fetchMarkdownFile(a),!1})}var a,b,c,d,e="/img/notebook_paper_200x200.gif",f={theme:"ace/theme/clouds_midnight",showPaper:!0,currentMd:"",autosave:{enabled:!0,interval:3e3},current_filename:"Untitled Document",dropbox:{filepath:"/Dillinger/"}},g="dillinger",h=document.createElement(g),i=h.style,j="Webkit Moz O ms Khtml".split(" "),k=$("#theme-list"),l=$("#preview"),m=$("#autosave"),n=$("#import_github"),o={chrome:"#bbbbbb",clouds:"#7AC9E3",clouds_midnight:"#5F9EA0",cobalt:"#4d586b",crimson_editor:"#ffffff",dawn:"#DADCAD",eclipse:"#6C7B8A",idle_fingers:"#DEB887",kr_theme:"#434343",merbivore:"#3E353E",merbivore_soft:"#565156",mono_industrial:"#C0C0C0",monokai:"#F5DEB3",pastel_on_dark:"#676565","solarized-dark":"#0E4B5A",solarized_light:"#dfcb96",textmate:"#fff",tomorrow:"#0e9211",tomorrow_night:"#333536",tomorrow_night_blue:"#3a4150",tomorrow_night_bright:"#3A3A3A",tomorrow_night_eighties:"#474646",twilight:"#534746",vibrant_ink:"#363636"},Y=function(){var a=$("#notify");return{messages:{profileUpdated:"Profile updated",profileCleared:"Profile cleared",docSavedLocal:"Document saved locally",docSavedServer:"Document saved on our server",docSavedDropbox:"Document saved on dropbox",dropboxImportNeeded:"Please import a file from dropbox first."},showMessage:function(b,c){a.text("").stop().text(b).slideDown(250,function(){a.delay(c||1e3).slideUp(250)})}}}(),Z=function(){function b(a,b){var c=a.url.toLowerCase(),d=b.url.toLowerCase();return c===d?0:isNaN(a)||isNaN(b)?c>d?1:-1:a-b}function c(a){return/(\.md)|(\.markdown)/i.test(a)}function e(a,b){var e=[],f="https://raw.github.com",g="/";return b.forEach(function(b){if(c(b.path)){var h;Z.isRepoPrivate?h=b.url:h=f+g+d+g+a+g+Z.currentBranch+g+b.path;var i={link:h,path:b.path,sha:b.sha};e.push(i)}}),e}function f(a){var c="<ul>";return a.sort(b),a.forEach(function(a){var b=a.url.split("/").pop();c+='<li data-repo-name="'+b+'" data-repo-private="'+a["private"]+'"><a class="repo" href="#">'+b+"</a></li>"}),c+="</ul>",$(".modal-header h3").text("Your Github Repos"),$(".modal-body").html(c),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0}),!1}function g(a,b){var c="";b.forEach(function(b){var d=b.name,e=b.commit.sha;c+='<li data-repo-name="'+a+'" data-commit-sha="'+e+'"><a class="branch" href="#">'+d+"</a></li>"}),$(".modal-header h3").text(a),$(".modal-body").find("ul").find("li").remove().end().append(c)}function h(a,b){var c=e(a,b),d="";c.forEach(function(a){d+=Z.isRepoPrivate?'<li data-tree-file-sha="'+a.sha+'" data-tree-file="'+a.link+'" class="private_repo"><a class="tree_file" href="#">'+a.path+"</a></li>":'<li data-tree-file="'+a.link+'"><a class="tree_file" href="#">'+a.path+"</a></li>"}),$(".modal-header h3").text(a),$(".modal-body").find("ul").find("li").remove().end().append(d)}return{currentBranch:"",isRepoPrivate:!1,fetchRepos:function(){function a(){Y.showMessage("Fetching Repos...")}function b(a,b,c){a=b=null,c=JSON.parse(c.responseText),c.length?f(c):Y.showMessage("No repos available!")}function c(){alert("Roh-roh. Something went wrong. :(")}var d={type:"POST",dataType:"text",url:"/import/github/repos",beforeSend:a,error:c,success:b};$.ajax(d)},fetchBranches:function(a){function b(){Y.showMessage("Fetching Branches for Repo "+a)}function c(b,c,d){b=c=null,d=JSON.parse(d.responseText),d.length?g(a,d):(Y.showMessage("No branches available!"),$("#modal-generic").modal("hide"))}function d(){alert("Roh-roh. Something went wrong. :(")}var e={type:"POST",dataType:"json",data:"repo="+a,url:"/import/github/branches",beforeSend:b,error:d,success:c};$.ajax(e)},fetchTreeFiles:function(a,b){function c(){Y.showMessage("Fetching Tree for Repo "+a)}function d(b,c,d){b=c=null,d=JSON.parse(d.responseText),d.tree.length?h(a,d.tree):(Y.showMessage("No tree files available!"),$("#modal-generic").modal("hide"))}function e(){alert("Roh-roh. Something went wrong. :(")}var f={type:"POST",dataType:"json",data:"repo="+a+"&sha="+b,url:"/import/github/tree_files",beforeSend:c,error:e,success:d};$.ajax(f)},fetchMarkdownFile:function(b){function c(c,d,e){c=d=null,e=JSON.parse(e.responseText);if(e.error)Y.showMessage("No markdown for you!"),$("#modal-generic").modal("hide");else{$("#modal-generic").modal("hide"),a.getSession().setValue(e.data);var f=b.split("/").pop();L(f),z(f),K()}}function d(){alert("Roh-roh. Something went wrong. :(")}function e(){$(".dropdown").removeClass("open")}var f={type:"POST",dataType:"json",data:"mdFile="+b,url:"/import/github/file",error:d,success:c,complete:e};$.ajax(f)}}}(),_=function(){function b(a,b){var c=a.path.toLowerCase(),d=b.path.toLowerCase();return c===d?0:isNaN(a)||isNaN(b)?c>d?1:-1:a-b}function c(a){var c="<ul>";return a.sort(b),a.forEach(function(a){c+='<li data-file-path="'+a.path+'"><a class="dropbox_file" href="#">'+a.path+"</a></li>"}),c+="</ul>",$(".modal-header h3").text("Your Dropbox Files"),$(".modal-body").html(c),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0}),!1}function d(a){return encodeURIComponent(a.split("/").pop())}function e(a){var b=a.split("/").pop();return a.replace(b,"")}return{fetchAccountInfo:function(){function a(){Y.showMessage("Fetching User Info from Dropbox")}function b(a,b,c){var d=JSON.parse(c.responseText);Y.showMessage("Sup "+d.display_name)}function c(){alert("Roh-roh. Something went wrong. :(")}var d={type:"GET",dataType:"json",url:"/account/dropbox",beforeSend:a,error:c,success:b};$.ajax(d)},fetchMetadata:function(){function a(){Y.showMessage("Fetching Metadata")}function b(a,b,c){var d=JSON.parse(c.responseText);window.console&&window.console.log&&console.dir(d)}function c(){alert("Roh-roh. Something went wrong. :(")}var d={type:"GET",dataType:"json",url:"/dropbox/metadata",beforeSend:a,error:c,success:b};$.ajax(d)},searchDropbox:function(){function a(){Y.showMessage("Searching for .md Files")}function b(a,b,d){a=b=null;var e=JSON.parse(d.responseText);if(e.hasOwnProperty("statusCode")&&e.statusCode===401){var f=JSON.parse(e.data);Y.showMessage("Error! "+f.error,1e3),setTimeout(function(){Y.showMessage("Reloading!"),window.location.reload()},1250);return}e.length?c(e):Y.showMessage("No .md files found!")}function d(){alert("Roh-roh. Something went wrong. :(")}var e={type:"GET",dataType:"json",url:"/import/dropbox",beforeSend:a,error:d,success:b};$.ajax(e)},fetchMarkdownFile:function(b){function c(b,c,d){d=JSON.parse(d.responseText);if(d.statusCode===404){var e=JSON.parse(d.data);Y.showMessage(e.error)}else $("#modal-generic").modal("hide"),L(f.current_filename),z(),a.getSession().setValue(d.data),K()}function g(){alert("Roh-roh. Something went wrong. :(")}var h=d(b),i=e(b);b=i+h;var j={type:"POST",dataType:"json",data:"mdFile="+b,url:"/fetch/dropbox",error:g,success:c};$.ajax(j)},setFilePath:function(a){a=e(a),s({dropbox:{filepath:a}})},putMarkdownFile:function(){function b(a,b,c){a=b=null,c=JSON.parse(c.responseText);if(c.statusCode>=204){var d=JSON.parse(c.data);Y.showMessage(d.error,5e3)}else $("#modal-generic").modal("hide"),Y.showMessage(Y.messages.docSavedDropbox)}function c(){alert("Roh-roh. Something went wrong. :(")}var d=encodeURIComponent(a.getSession().getValue()),e="pathToMdFile="+f.dropbox.filepath+encodeURIComponent(f.current_filename)+".md"+"&fileContents="+d,g={type:"POST",dataType:"json",data:e,url:"/save/dropbox",error:c,success:b};$.ajax(g)}}}();A()}),window.onload=function(){var a=$("#loading");a.bind($.support.transitionEnd,function(){$("#main").removeClass("bye"),a.remove()}).addClass("fade_slow")}